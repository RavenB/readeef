package repo

type Err interface {
	Err() error
}

type Repo interface {
	Err

	// func (db DB) GetUser(login string) (User, error) {
    UserByLogin(login content.Login) content.User
	// func (db DB) GetUserByMD5Api(md5 []byte) (User, error) {
    UserByMD5Api(md5 []byte) content.User
	// func (db DB) GetUsers() ([]User, error) {
	AllUsers() []content.User

	// func (db DB) GetFeed(id int64) (Feed, error) {
	FeedById(id content.FeedId) content.Feed
	// func (db DB) GetFeedByLink(link string) (Feed, error) {
	FeedByLink(link string) content.Feed

	// func (db DB) GetFeeds() ([]Feed, error) {
	AllFeeds() []content.Feed
	// func (db DB) GetUnsubscribedFeed() ([]Feed, error) {
	AllUnsubscribedFeeds() []content.Feed

	// func (db DB) GetHubbubSubscriptions() ([]*HubbubSubscription, error) {
	AllSubscriptions() []content.Subscription

	// func (db DB) GetAllArticles() ([]Article, error) {
	// Not implemented, get all feeds, then get their articles
}

// package content

type Login string
type TagValue string
type FeedId int64
type ArticleId int64

type User interface {
	Err

	Set(info info.User) User
	Info() info.User

	// func (db DB) UpdateUser(u User) error {
	Update(info info.User) User
	// func (db DB) DeleteUser(u User) error {
	Delete() User

	// func (db DB) GetUserFeed(id int64, u User) (Feed, error) {
	Feed(id FeedId) UserFeed
	// func (db DB) CreateUserFeed(u User, f Feed) (Feed, error) {
	AddFeed(feed Feed) UserFeed

	// func (db DB) GetUserFeeds(u User) ([]Feed, error) {
	AllFeeds() []UserFeed

	// func (db DB) GetUserTagsFeeds(u User) ([]Feed, error) {
	AllTaggedFeeds() []TaggedFeed

	// func (db DB) GetFeedArticle(articleId int64, user User) (Article, error) {
	Article(id ArticleId) UserArticle

	// func (db DB) GetSpecificUserArticles(u User, ids ...int64) ([]Article, error) {
	ArticlesById(ids ...ArticleId) []UserArticle

	// func (db DB) GetAllUnreadUserArticleIds(u User) ([]int64, error) {
	AllUnreadArticleIds() []ArticleId
	// func (db DB) GetAllFavoriteUserArticleIds(u User) ([]int64, error) {
	AllFavoriteIds() []ArticleId

	// func (db DB) GetUserArticleCount(u User) (int64, error) {
	ArticleCount() int64

	// func (db DB) GetUserArticles[Desc](u User, paging ...int) ([]Article, error) {
	Articles(desc bool, paging ...int) []UserArticle
	// func (db DB) GetUnreadUserArticles[Desc](u User, paging ...int) ([]Article, error) {
	UnreadArticles(desc bool, paging ...int) []UserArticle
	// func (db DB) GetUnorderedUserArticles[Desc](u User, since int64, paging ...int) ([]Article, error) {
	ArticlesOrderedById(pivot ArticleId, desc bool, paging ...int) []UserArticle
	// func (db DB) GetUserFavoriteArticles[Desc](u User, paging ...int) ([]Article, error) {
	FavoriteArticles(desc bool, paging ...int) []UserArticle

	// func (db DB) MarkUserArticlesByDateAsRead(u User, d time.Time, read bool) error {
	ReadBefore(date time.Time, read bool) Repo
	// func (db DB) MarkNewerUserArticlesByDateAsUnread(u User, d time.Time, read bool) error {
	ReadAfter(date time.Time, read bool) Repo

	// func (db DB) GetScoredUserArticles[Desc](u User, timeRange TimeRange, paging ...int) ([]Article, error) {
	ScoredArticles(from, to time.Time, desc bool, paging ...int) []ScoredArticle

	// func (db DB) GetUserTags(u User) ([]string, error) {
	Tags() []Tag
}

type Tag interface {
	Err
	fmt.Stringer

	Set(value TagValue) Tag
	Value() TagValue

	// func (db DB) GetUserTagFeeds(u User, tag string) ([]Feed, error) {
	AllFeeds() []TaggedFeed

	// func (db DB) GetUserTagArticles[Desc](u User, tag string, paging ...int) ([]Article, error) {
	Articles(desc bool, paging ...int) []UserArticle
	// func (db DB) GetUnreadUserTagArticles(u User, tag string, paging ...int) ([]Article, error) {
	UnreadArticles(desc bool, paging ...int) []UserArticle

	// func (db DB) MarkUserTagArticlesByDateAsRead(u User, tag string, d time.Time, read bool) error {
	ReadBefore(date time.Time, read bool) Tag

	// func (db DB) GetScoredUserTagArticles[Desc](u User, tag string, timeRange TimeRange, paging ...int) ([]Article, error) {
	ScoredArticles(from, to time.Time, desc bool, paging ...int) []ScoredArticle
}

type Feed interface {
	Err

	Set(info info.Feed) Feed
	Info() info.Feed

	// Returns any new articles since the previous Update
	NewArticles() []Article

	// func (db DB) UpdateFeed(f Feed) (Feed, bool, error) {
	Update(info info.Feed) Feed
	// func (db DB) DeleteFeed(f Feed) error {
	Delete() Feed

	// func (db DB) GetAllFeedArticles(f Feed) ([]Article, error) {
	AllArticles() []Article
	// func (db DB) GetLatestFeedArticles(f Feed) ([]Article, error) {
	LatestArticles() []Article

	// func (db DB) CreateFeedArticles(f Feed, articles []Article) (Feed, error) {
	AddArticles([]Article) Feed

	// func (db DB) GetHubbubSubscription(feedId int64) (*HubbubSubscription, error) {
	Subscription() hubbub.Subscription
}

type UserFeed interface {
	Feed

	User() User

	// func (db DB) GetFeedUsers(f Feed) ([]User, error) {
	Users() []User

	// func (db DB) DeleteUserFeed(f Feed) error {
	Delete() UserFeed

	// func (db DB) GetFeedArticles[Desc](f Feed, paging ...int) (Feed, error) {
	Articles(desc bool, paging ...int) []UserArticle
	// func (db DB) GetUnreadFeedArticles[Desc](f Feed, paging ...int) (Feed, error) {
	UnreadArticles(desc bool, paging ...int) []UserArticle

	// func (db DB) MarkFeedArticlesByDateAsRead(f Feed, d time.Time, read bool) error {
	ReadBefore(date time.Time, read bool) UserFeed

	// func (db DB) GetScoredFeedArticles[Desc](f Feed, timeRange TimeRange, paging ...int) (Feed, error) {
	ScoredArticles(from, to time.Time, paging ...int) []ScoredArticles
}

type TaggedFeed interface {
	UserFeed

	Tags() []Tag

	// func (db DB) CreateUserFeedTag(f Feed, tags ...string) error {
	AddTags(tags ...Tag) TaggedFeed
	// func (db DB) DeleteUserFeedTag(f Feed, tags ...string) error {
	DeleteAllTags() TaggedFeed

	// func (db DB) GetUserFeedTags(u User, f Feed) ([]string, error) {
	// Not implemented, its only used for removing the fetched tags
}

type Article interface {
	Err

	Set(info info.Article) Article
	Info() info.Article
}

type UserArticle interface {
	Article

	User() user.User

	// db.Freeze(tx) for more than one
	// func (db DB) MarkUserArticlesAsRead(u User, articles []Article, read bool) error {
	Read(read bool) UserArticle
	// func (db DB) MarkUserArticlesAsFavorite(u User, articles []Article, read bool) error {
	Favorite(favorite bool) UserArticle
}

type ScoredArticle interface {
	UserArticle

	// func (db DB) UpdateArticleScores(asc ArticleScores) error {
	SetScores(asc ArticleScores) ScoredArticle
	// func (db DB) GetArticleScores(a Article) (ArticleScores, error) {
	Scores() ArticleScores
}

type Subscription interface {
	Err

	Set(info info.Subscription) Subscription
	Info() info.Subscription

	// func (db DB) UpdateHubbubSubscription(s *HubbubSubscription) error {
	Update(info Info) Subscription
	// func (db DB) DeleteHubbubSubscription(s *HubbubSubscription) error {
	Delete() Subscription

	// func (db DB) FailHubbubSubscriptions() error {
	Fail(fail bool) Subscription
}

// package info

type User struct { /* move readeef.User here */ }
type Feed struct { /* move readeef.Feed here */ }
type Article struct { /* move readeef.Article here */ }
type Subscription struct { /* old readeef.HubbubSubscription */}
